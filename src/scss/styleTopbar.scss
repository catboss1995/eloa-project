@use "styleReset" as *;

/* 導航列主體 - 使用 will-change 提高動畫性能 */
nav {
    display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 64px;
    align-items: center;
    justify-content: space-between;
    background-color: $white;
    z-index: 999;
    transition: all 0.3s ease;
    padding: 0 max(20px, env(safe-area-inset-left)) 0 max(20px, env(safe-area-inset-right));
    will-change: transform, background-color; // 優化動畫性能
    background-color: rgba(255, 255, 255, 0.8); // 使用 rgba 代替變數，提高渲染性能
    backdrop-filter: blur(5px);

    &.scroll {
        background-color: rgba(255, 255, 255, 0.6); // 使用 rgba 代替變數，提高渲染性能
        backdrop-filter: blur(10px);
    }
}

#topbar-logo {
    height: 40px;
    padding-left: 25px;
    object-fit: contain;
}

// 漢堡按鈕優化 - 使用 transform 代替 margin 提高性能
.hamburger-btn {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 32px;
    height: 32px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    margin-right: 20px;
    position: relative;
    z-index: 1001;
    will-change: transform; // 優化動畫性能

    span {
        display: block;
        width: 25px;
        height: 3px;
        background-color: #2c1810;
        margin: 3px 0;
        transition: transform 0.3s cubic-bezier(0.645, 0.045, 0.355, 1),
            opacity 0.2s ease; // 分離屬性提高性能
        transform-origin: center;
        border-radius: 1px;
        will-change: transform, opacity; // 優化動畫性能
    }

    &.active {
        span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        span:nth-child(2) {
            opacity: 0;
            transform: scale(0);
        }

        span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
    }
}

// 桌面版導航優化
.desktop-nav {
    display: flex;
}

.nav-right {
    width: fit-content;
    align-items: center;
    gap: clamp(12px, 2vw, 20px);
    padding-right: max(20px, env(safe-area-inset-right));

    .text-link {
        text-decoration: none;
        font-size: $font18-light;
        color: $light-brown5;
        position: relative;
        display: inline-block;
        text-wrap: nowrap;

        transition: color 0.3s ease, transform 0.3s ease;
        will-change: transform; // 優化動畫性能

        &:hover {
            transform: translateY(-2px);
        }

        &::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: $light-brown5;
            transition: width 0.3s ease;
            will-change: width; // 優化動畫性能
        }

        &:hover::after {
            width: 100%;
        }
    }

    .cart-btn {
        display: flex;
        align-items: center;
        cursor: pointer;
        color: $light-brown5;
    }

    img {
        height: 30px;
    }
}

// 下拉菜單優化 - 使用 transform 代替 opacity 提高性能
.dropdown-container {
    position: relative;
    display: inline-block;

    .dropdown-trigger {
        display: flex;
        align-items: center;
        gap: 10px;
        background: none;
        border: none;
        cursor: pointer;
        font-family: inherit;
        padding: 0;

        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
            will-change: transform; // 優化動畫性能

            &.open {
                transform: rotate(180deg);
            }
        }
    }

    .dropdown-menu {
        position: absolute;
        overflow: hidden;
        top: calc(100% + 10px);
        left: -50%;
        background-color: $white;
        border-radius: 8px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        min-width: 180px;
        animation: dropdownFadeIn 0.3s ease;
        z-index: 1000;
        will-change: transform, opacity; // 優化動畫性能

        &::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 20px;
            width: 12px;
            height: 12px;
            background-color: $white;
            border: 1px solid rgba($light-brown5, 0.1);
            border-bottom: none;
            border-right: none;
            transform: rotate(45deg);
        }

        .dropdown-item {
            display: block;
            padding: 12px 20px;
            text-decoration: none;
            color: $light-brown5;
            font-size: $font16-light;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            white-space: pre-line;
            border-bottom: 1px solid $beige2;
            will-change: transform, background-color; // 優化動畫性能

            &:hover {
                background-color: rgba($light-brown5, 0.05);
                border-left-color: $light-brown5;
                transform: translateX(5px);
            }
        }
    }
}

// 下拉菜單動畫優化 - 使用 transform 代替 opacity
@keyframes dropdownFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

// 手機版滑出選單 - 參考購物車風格
.mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    height: 100dvh;
    z-index: 1000;
    visibility: hidden;
    pointer-events: none;
    transition: visibility 0.3s ease;

    &.active {
        visibility: visible;
        pointer-events: auto;
    }

    .mobile-menu-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1000;
    }

    &.active .mobile-menu-overlay {
        opacity: 1;
    }

    .mobile-menu-content {
        position: absolute;
        top: 0;
        right: 0;
        width: 80%;
        max-width: 320px;
        height: 100%;
        display: flex;
        flex-direction: column;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        background-color: #ffffff; // 改為白色背景，與購物車一致
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        z-index: 1001;
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
    }

    &.active .mobile-menu-content {
        transform: translateX(0);
    }
}

// 標題欄 - 參考購物車風格
.mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #ffffff; // 改為白色背景
    border-bottom: 1px solid #caae81; // 金色分隔線，與購物車一致

    a {
        display: block;
    }

    .mobile-logo {
        height: 28px;
        object-fit: contain;
    }

    .close-btn {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;

        &::before,
        &::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 2px;
            background-color: #2c1810; // 深褐色，與購物車一致
        }

        &::before {
            transform: rotate(45deg);
        }

        &::after {
            transform: rotate(-45deg);
        }
    }
}

// 選單主體 - 參考購物車風格
.mobile-menu-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px 0;
}

// 選單項目 - 參考購物車風格
.mobile-menu-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    text-decoration: none;
    color: #2c1810;
    font-size: 16px;
    font-weight: 500;
    border-bottom: 1px solid rgba(202, 174, 129, 0.3); // 淡金色分隔線

    .mobile-arrow {
        font-size: 12px;
        transition: transform 0.3s ease;

        &.open {
            transform: rotate(180deg);
        }
    }
}

// 產品列表 - 參考購物車風格
.mobile-product-list {
    background-color: rgba(202, 174, 129, 0.05); // 淡金色背景
    padding: 5px 0;
}

.mobile-product-item {
    display: block;
    padding: 12px 20px 12px 40px;
    text-decoration: none;
    color: #2c1810;
    font-size: 14px;
    border-bottom: 1px solid rgba(202, 174, 129, 0.15); // 更淡的金色分隔線

    &:last-child {
        border-bottom: none;
    }
}

// 底部功能區域 - 參考購物車風格
.mobile-menu-footer {
    display: flex;
    justify-content: space-around;
    padding: 15px 20px;
    border-top: 1px solid #caae81; // 金色分隔線，與購物車一致
    background-color: #ffffff;
    margin-top: auto; // 確保它在底部
}

.mobile-function-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #2c1810;

    .icon-container {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;

        img {
            width: 24px;
            height: 24px; // 修正：添加高度單位
            object-fit: contain;
        }
    }

    span {
        font-size: 14px;
        font-weight: 500;
    }
}

// 確保遮罩在選單後面
.mobile-menu-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
}

.mobile-menu.active .mobile-menu-overlay {
    opacity: 1;
}

// 手機版優化 - 減少不必要的動畫和效果
@media (max-width: 767px) {

    // 優化觸控互動
    .mobile-menu-item,
    .mobile-product-item,
    .mobile-function-btn {
        -webkit-tap-highlight-color: transparent; // 移除觸控高亮
    }

    // 減少陰影複雜度以提高性能
    .mobile-menu-content {
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.15);
    }
}

// 添加硬體加速 - 針對動畫元素
.mobile-menu-content,
.hamburger-btn span,
.dropdown-menu,
.text-link,
.mobile-arrow {
    transform: translateZ(0); // 強制 GPU 加速
}

// 手機橫向/小平板 (767px 以下) - 漢堡選單登場
@media (max-width: 767px) {
    .hamburger-btn {
        display: flex; // 顯示漢堡按鈕
    }

    .desktop-nav {
        display: none; // 隱藏桌面選單
    }

    #topbar-logo {
        padding-left: 20px;
        height: 36px; // 手機版logo小一點
    }

    nav {
        height: 60px; // 手機版導航列低一點
        padding: 0 20px;
    }
}

// 小手機 (480px 以下) - 選單全螢幕
@media (max-width: 480px) {
    .mobile-menu-content {
        width: 100vw; // 小螢幕就全螢幕吧
    }

    .mobile-menu-header {
        padding: 16px 20px;
    }

    .mobile-menu-item {
        padding: 14px 20px;
        font-size: 15px;
        font-weight: 500; // 保持加粗
    }

    .mobile-product-item {
        padding: 10px 20px 10px 40px;
        font-size: 13px;
        font-weight: 400; // 保持可讀性
    }

    .mobile-menu-footer {
        padding: 16px 20px;
        gap: 12px;
    }

    .mobile-function-btn {
        min-width: 70px;
        padding: 10px 12px;
        font-size: 11px;
        font-weight: 500; // 加粗

        img {
            width: 20px;
            height: 20px; // 修正：添加高度單位
        }
    }
}